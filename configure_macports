#!/bin/sh

# configure_macports — Configure MacPorts

# Install MacPorts (https://github.com/melusina-org/gha-install-macports)
# This file is part of Install MacPorts.
#
# Copyright © 2022 Michaël Le Barbier
# All rights reserved.

# This file must be used under the terms of the MIT License.
# This source file is licensed as described in the file LICENSE, which
# you should have received as part of this distribution. The terms
# are also available at https://opensource.org/licenses/MIT

prefix='/opt/local'

usage()
{
    cat <<'EOF'
Usage: configure_macports
 Configure MacPorts.
EOF
}

ensure_macos()
{
    case $(uname) in
       Darwin)
           return 0
           ;;
    esac

    1>&2 printf 'Failure: \047%s\047 is not a MacOS platform.\n' $(uname) 
    exit 1
}

print_configuration_summary()
{
    find\
	"${prefix}/etc/gha-install-macports"\
	"${prefix}/etc/macports"\
	-type f -not -name '*.default' -exec awk '
FNR == 1 && NR > 1 {
  printf("::endgroup::\n")
}

FNR == 1 {
  printf("::group::Configuration File %s\n", FILENAME)
}

{print}

END {
  printf("::endgroup::\n")
}
' '{}' '+'          

}

main()
{
    ensure_macos

    case "$#" in
	0)
	    :
	    ;;
	*)
	    1>&2 printf 'Failure: Too many arguments.\n'
	    usage
	    exit 64
	    ;;
    esac

    for file in variants sources; do
	source="${prefix}/etc/gha-install-macports/${file}.conf"
	destination="${prefix}/etc/macports/${file}.conf"
	if [ -f "${source}" ]; then
	    cp -f "{source}" "${destination}"
	fi
    done
    print_configuration_summary
}

main "$@"

# End of file `configure_macports'
